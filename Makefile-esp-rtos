PROGRAM ?= calvin-esp
SDK_PATH ?= /home/qfrksvn/Source/esp-open-rtos

PROGRAM_SRC_FILES = \
	main.c \
	runtime/south/platform/esp-open-rtos/cc_platform_esp8266.c \
	runtime/south/platform/esp-open-rtos/calvinsys/cc_calvinsys_ds18b20.c \
	runtime/south/platform/esp-open-rtos/calvinsys/cc_calvinsys_gpio.c \
	runtime/south/platform/esp-open-rtos/calvinsys/cc_calvinsys_yl69.c

# esp-open-rtos runtime config
SOCKET = 1
STORAGE = 1

include calvin.mk

PROGRAM_SRC_FILES += $(CC_SRC_C)
EXTRA_CFLAGS += $(CC_CFLAGS)

ifeq ($(PYTHON),1)
LIBS = hal m micropython
EXTRA_LDFLAGS = -Llibmpy
EXTRA_CFLAGS += -Ilibmpy/build -Imicropython -Ilibmpy
EXTRA_CFLAGS += -DCC_PYTHON_ENABLED -DCC_PYTHON_HEAP_SIZE=10*1024 -DCC_PYTHON_STACK_SIZE=8192
EXTRA_CFLAGS += -DCC_ACTOR_MODULES_DIR=\""mpys/\""
PROGRAM_SRC_FILES += $(CC_SRC_C_MPY)
endif

# extras/dhcpserver
EXTRA_COMPONENTS += extras/dhcpserver

# spiffs
EXTRA_COMPONENTS += extras/spiffs
# 1MB config
#FLASH_SIZE = 8
#SPIFFS_BASE_ADDR = 0x6b000
# 4 MB config
FLASH_SIZE ?= 32
SPIFFS_BASE_ADDR ?= 0x200000
SPIFFS_SIZE ?= 0x010000

# ds18b20
EXTRA_COMPONENTS += extras/onewire extras/ds18b20

include $(SDK_PATH)/common.mk
